-- create table scanning_tasks
CREATE TABLE scanning_tasks (
    id UUID NOT NULL,
    status TEXT NOT NULL,
    repository_name TEXT NOT NULL,
    repository_url TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE,
    updated_at  TIMESTAMP WITH TIME ZONE,
    deleted_at TIMESTAMP WITH TIME ZONE,
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    error TEXT,
    PRIMARY KEY (id)
);

-- create table vulnerabilities
CREATE TABLE vulnerabilities (
    id SERIAL PRIMARY KEY,
    scanning_task_id UUID NOT NULL,
    type TEXT NOT NULL,
    rule_id TEXT NOT NULL,
    path TEXT NOT NULL,
    line INTEGER NOT NULL,
    description TEXT NOT NULL,
    severity TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE,
    updated_at  TIMESTAMP WITH TIME ZONE,
    deleted_at TIMESTAMP WITH TIME ZONE,
    FOREIGN KEY (scanning_task_id) REFERENCES scanning_tasks (id) ON DELETE CASCADE
);