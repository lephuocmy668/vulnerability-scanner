// this file defines an endpoint for adding a new scanning task.
// It takes a scanner service as input and returns an endpoint
// function that takes a context and a request interface as input,
// and returns a response interface and an error.
package endpoint

import (
	"context"

	"github.com/go-kit/kit/endpoint"
	domain "github.com/lephuocmy668/vulnerability-scanner/domain"
)

// addTaskResponse is the response payload for the add task endpoint
type addTaskResponse struct {
	Task *domain.ScanningTask `json:"task,omitempty"`
	Err  error                `json:"error,omitempty"`
}

// error is a method that returns the error associated with the response
func (r addTaskResponse) error() error { return r.Err }

// MakeAddTaskEndpoint returns an endpoint for adding a scanning task
func MakeAddTaskEndpoint(ts domain.ScannerService) endpoint.Endpoint {
	return func(ctx context.Context, request interface{}) (interface{}, error) {
		req := request.(domain.CreateTaskRequest)
		task, err := ts.CreateTask(req)
		return getTaskDetailResponse{Task: task, Err: err}, err
	}
}
